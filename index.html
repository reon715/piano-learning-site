<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Piano Learning App</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffeb3b">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  text-align: center;
  padding: 20px;
}

h1 {
  margin-bottom: 5px;
}

p {
  margin-top: 0;
  color: #444;
}

/* ===== Piano ===== */
.piano-wrapper {
  overflow-x: auto;
  margin: 30px auto;
}

.piano {
  display: flex;
  width: max-content;
}

/* White keys */
.white-key {
  position: relative;
  width: 60px;
  height: 220px;
  border: 1px solid #333;
  background: white;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding-bottom: 8px;
  cursor: pointer;
  user-select: none;
}

/* Stage guide (yellow) */
.white-key.guide {
  background: #ffeb3b;
}

/* Black keys */
.black-key {
  position: absolute;
  right: -20px;
  top: 0;
  width: 40px;
  height: 140px;
  background: black;
  color: white;
  z-index: 10;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding-bottom: 6px;
  font-size: 12px;
  user-select: none;
}
</style>
</head>

<body>

<h1>ðŸŽ¹ Piano Learning App</h1>
<p>
Learn piano step by step using a stage-based guide system.
Only the highlighted (yellow) keys should be played.
</p>

<div>
  <button onclick="setStage(1)">Stage 1</button>
  <button onclick="setStage(2)">Stage 2</button>
  <button onclick="setStage(3)">Stage 3</button>
</div>

<div class="piano-wrapper">
  <div class="piano">

    <!-- ===== Octave 4 ===== -->
    <div class="white-key" data-note="C4">C4<div class="black-key">C#</div></div>
    <div class="white-key" data-note="D4">D4<div class="black-key">D#</div></div>
    <div class="white-key" data-note="E4">E4</div>
    <div class="white-key" data-note="F4">F4<div class="black-key">F#</div></div>
    <div class="white-key" data-note="G4">G4<div class="black-key">G#</div></div>
    <div class="white-key" data-note="A4">A4<div class="black-key">A#</div></div>
    <div class="white-key" data-note="B4">B4</div>

    <!-- ===== Octave 5 ===== -->
    <div class="white-key" data-note="C5">C5<div class="black-key">C#</div></div>
    <div class="white-key" data-note="D5">D5<div class="black-key">D#</div></div>
    <div class="white-key" data-note="E5">E5</div>
    <div class="white-key" data-note="F5">F5<div class="black-key">F#</div></div>
    <div class="white-key" data-note="G5">G5<div class="black-key">G#</div></div>
    <div class="white-key" data-note="A5">A5<div class="black-key">A#</div></div>
    <div class="white-key" data-note="B5">B5</div>

  </div>
</div>

<script>
// ===== Audio =====
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playNote(freq) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "sine";
  osc.frequency.value = freq;

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.6);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.6);
}

const noteFreq = {
  C4: 261.63, D4: 293.66, E4: 329.63, F4: 349.23,
  G4: 392.0,  A4: 440.0,  B4: 493.88,
  C5: 523.25, D5: 587.33, E5: 659.25,
  F5: 698.46, G5: 783.99, A5: 880.0, B5: 987.77
};

// ===== Stage definitions =====
const stages = {
  1: ["C4", "G4", "A4"],
  2: ["C4", "G4", "C5", "G5"],
  3: ["C4", "D4", "E4", "F4", "G4", "A4", "C5", "D5", "E5"]
};

let currentStage = 1;

// ===== Update guide =====
function updateGuide() {
  document.querySelectorAll(".white-key").forEach(key => {
    key.classList.remove("guide");
    if (stages[currentStage].includes(key.dataset.note)) {
      key.classList.add("guide");
    }
  });
}

function setStage(stage) {
  currentStage = stage;
  updateGuide();
}

// ===== Click sound =====
document.querySelectorAll(".white-key").forEach(key => {
  key.addEventListener("click", () => {

    if (audioCtx.state === "suspended") {
      audioCtx.resume();
    }

    const note = key.dataset.note;

    if (key.classList.contains("guide") && noteFreq[note]) {
      playNote(noteFreq[note]);
    }
  });
});

// ===== Initialize =====
updateGuide();
</script>

</body>
</html>
