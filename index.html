<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Piano Learning App</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #f4f4f4;
  padding: 20px;
}

.nav button {
  margin: 5px;
  padding: 10px 15px;
}

/* ===== ãƒ”ã‚¢ãƒ ===== */
.piano-wrapper {
  overflow-x: auto;
  margin: 30px auto;
}

.piano {
  display: flex;
  width: max-content;
}

/* ç™½éµ */
.white-key {
  position: relative;
  width: 60px;
  height: 220px;
  border: 1px solid #333;
  background: white;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding-bottom: 8px;
  cursor: pointer;
}

.white-key.active {
  background: #ffeb3b;
}

.black-key {
  position: absolute;
  right: -20px;
  top: 0;
  width: 40px;
  height: 140px;
  background: black;
  color: white;
  z-index: 10;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding-bottom: 6px;
  font-size: 12px;
  cursor: pointer;
}

.black-key.active {
  background: #ff9800;
}
</style>
</head>

<body>

<h1>ğŸ¹ Piano Learning App</h1>
<p>ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¶ã‚¬ã‚¤ãƒ‰ä»˜ãï¼ˆå…‰ã‚‹éµç›¤ï¼‰</p>

<div class="nav">
  <button onclick="setStage(1)">Stage 1 å³æ‰‹</button>
  <button onclick="setStage(2)">Stage 2 å·¦æ‰‹</button>
  <button onclick="setStage(3)">Stage 3 ä¸¡æ‰‹</button>
</div>

<div class="piano-wrapper">
  <div class="piano">

    <!-- Octave 4 -->
    <div class="white-key" data-note="C4">C4
      <div class="black-key" data-note="C#4">C#</div>
    </div>
    <div class="white-key" data-note="D4">D4
      <div class="black-key" data-note="D#4">D#</div>
    </div>
    <div class="white-key" data-note="E4">E4</div>
    <div class="white-key" data-note="F4">F4
      <div class="black-key" data-note="F#4">F#</div>
    </div>
    <div class="white-key" data-note="G4">G4
      <div class="black-key" data-note="G#4">G#</div>
    </div>
    <div class="white-key" data-note="A4">A4
      <div class="black-key" data-note="A#4">A#</div>
    </div>
    <div class="white-key" data-note="B4">B4</div>

  </div>
</div>

<script>
/* ===== Audio ===== */
let audioCtx = null;
const freqMap = {
  C4:261.63, D4:293.66, E4:329.63, F4:349.23,
  G4:392.00, A4:440.00, B4:493.88
};

function playNote(note) {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.frequency.value = freqMap[note];
  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.5);
}

/* ===== ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¶ã‚¬ã‚¤ãƒ‰ ===== */
let currentStage = 1;

const stages = {
  1: ["C4","G4","A4"],      // å³æ‰‹
  2: ["C4","G4"],           // å·¦æ‰‹
  3: ["C4","G4","A4"]       // ä¸¡æ‰‹
};

function setStage(stage) {
  currentStage = stage;
  updateGuide();
}

function updateGuide() {
  document.querySelectorAll('.white-key, .black-key').forEach(key => {
    key.classList.remove('active');
    if (stages[currentStage].includes(key.dataset.note)) {
      key.classList.add('active');
    }
  });
}

updateGuide();

/* éµç›¤ã‚¯ãƒªãƒƒã‚¯ */
document.querySelectorAll('.white-key').forEach(key => {
  key.addEventListener('click', () => {
    if (stages[currentStage].includes(key.dataset.note)) {
      playNote(key.dataset.note);
    }
  });
});
</script>

</body>
</html>
